"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.watchPageFiles = void 0;
const utils_1 = require("@vuepress/utils");
const chokidar = require("chokidar");
const handlePageAdd_1 = require("./handlePageAdd");
const handlePageChange_1 = require("./handlePageChange");
const handlePageUnlink_1 = require("./handlePageUnlink");
const watchPageFiles = (app) => {
    const pagesWatcher = chokidar.watch(app.options.pagePatterns, {
        cwd: app.dir.source(),
        ignoreInitial: true,
    });
    pagesWatcher.on('add', (filePathRelative) => {
        utils_1.logger.info(`page ${utils_1.chalk.magenta(filePathRelative)} is created`);
        handlePageAdd_1.handlePageAdd(app, app.dir.source(filePathRelative));
    });
    pagesWatcher.on('change', (filePathRelative) => {
        utils_1.logger.info(`page ${utils_1.chalk.magenta(filePathRelative)} is modified`);
        handlePageChange_1.handlePageChange(app, app.dir.source(filePathRelative));
    });
    pagesWatcher.on('unlink', (filePathRelative) => {
        utils_1.logger.info(`page ${utils_1.chalk.magenta(filePathRelative)} is removed`);
        handlePageUnlink_1.handlePageUnlink(app, app.dir.source(filePathRelative));
    });
    // TODO: watch page deps
    return pagesWatcher;
};
exports.watchPageFiles = watchPageFiles;
